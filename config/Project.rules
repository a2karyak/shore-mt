/* --------------------------------------------------------------- */
/* -- Copyright (c) 1994, 1995 Computer Sciences Department,    -- */
/* -- University of Wisconsin-Madison, subject to the terms     -- */
/* -- and conditions given in the file COPYRIGHT.  All Rights   -- */
/* -- Reserved.                                                 -- */
/* --------------------------------------------------------------- */

default: all
all::	automatic $(ALLTARGETS) $(EXEC)

do_subdirs($(SUBDIRCOMMANDS),$(SUBDIR))

do_tags($(TAGFILES))

tests:: ALWAYS
	if(test -d tests) then \
		(cd tests; $(MAKE) $(OPTIONS);)\
	fi; 
do_subdirs(tests,$(SUBDIR))

make:
	$(TOP)/tools/makemake $(TOP)

clean::
	@echo cleaning `pwd`

install::
clean_install::

depend:: automatic
	@touch .depend

/***************************************************************************/
/* a trick to tell if we're using the same make as the
 * one for which we configured the makefiles
 */
/* temp file */
MCK = /tmp/m.ck$$$$

#ifdef GNU_MAKE
/* to be evaluated immediately */
PWD = $(shell pwd)

/* test for mismatched MAKEs */
GTEST = -eq 0
/* msg to print if mismatched MAKEs */
GMSG = "Makefiles were configured for GNU make; you must use GNU make.  To configure for non-GNU make, unsetenv GNU_MAKE and re-run tools/makemake."

#else
/* Sun's /bin/make */

/* to be evaluated immediately */
PWD:sh = pwd
sh:: automatic

/* test for mismatched MAKEs */
GTEST = -gt 0
/* msg to print if mismatched MAKEs */
GMSG = "Makefiles were not configured for GNU make; you may not use GNU make.  To configure for GNU, setenv GNU_MAKE, and re-run tools/makemake."
#endif

nothing:;
automatic:: checkmake
checkmake::
	@($(MAKE) -v nothing 1>$(MCK) 2>&1 || echo "nope" 1>$(MCK););\
	set +e; j=eval grep -s "GNU" $(MCK);\
	if(test `grep -c "GNU" $(MCK)` $(GTEST)) then \
		echo $(GMSG); exit 1;\
	fi; /bin/rm -f $(MCK)

/***************************************************************************/
/* SYMLINKS - each Imakefile can override the default (empty) $(SYMLINKS) */
automatic:: symlinks
symlinks::  
clean_symlinks:: 

/***************************************************************************/

include .depend

/* Each subdir defines SRC.cvs -- those files to be checked in */
add:: 
	-for i in `echo $(SRC.cvs)`; do cvs add `basename $$i.junk .junk`; done;


symbolic_links($(SYMLINKS))
